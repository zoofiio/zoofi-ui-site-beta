"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8358],{22139:function(e,t,a){a.d(t,{Hj:function(){return r},Pq:function(){return s},SH:function(){return u},Vi:function(){return c},pn:function(){return l},v:function(){return o},xb:function(){return DOC_LINK}});var n=a(44769);let o="https://x.com/ZooFinanceIO",r="https://t.co/RJwdwdawe5",s=BigInt(1e18),l=BigInt(1e8),u=BigInt("31536000"),DOC_LINK=()=>"https://docs.".concat(n.Kh.value),c="beta";console.info("production")},44769:function(e,t,a){a.d(t,{Kh:function(){return o},Vi:function(){return useConfigDomain}});var n=a(64103);let o={value:"zoofi.io"},r=["zoofi.io","zoofi.xyz"],getAvilableDomain=()=>{var e;if("localhost"==location.hostname||(null===(e=location.hostname.match(/^\d+\.\d+\.\d+\.\d+$/))||void 0===e?void 0:e.length)==1)return r[0];let t=location.hostname.split("."),a=t.slice(-2).join(".");return("ipns"==t[1]&&(a=t[0].replaceAll("-",".")),r.includes(a))?a:r[0]};function useConfigDomain(){(0,n.useEffect)(()=>{o.value=getAvilableDomain()},[])}},18358:function(e,t,a){a.d(t,{R3:function(){return useUpBVaultForUserAction},Vw:function(){return useEpochesData},d6:function(){return useResetBVaultsData},gz:function(){return useCalcClaimable},nr:function(){return useBVault},oU:function(){return useBVaultApy},qM:function(){return useBVaultCurrentEpoch},v7:function(){return useBVaultBoost}});var n=a(22139),o=a(59175),r=a(26361),s=a(84944),l=a(83978),u=a.n(l),c=a(64103),i=a(96670),d=a(3106);function useResetBVaultsData(){let e=(0,o.p)(),{address:t}=(0,i.m)();(0,c.useEffect)(()=>{},[e]),(0,c.useEffect)(()=>{d.w.getState().sliceUserBVaults.reset()},[t])}function useBVault(e){let t=(0,d.R)(t=>t.sliceBVaultsStore.bvaults[e]||(0,r.Yb)({},0n));return t}function useBVaultCurrentEpoch(e){return(0,d.R)(t=>t.sliceBVaultsStore.bvaultsCurrentEpoch[e]||(0,r.Yb)({},0n))}function useEpochesData(e){let t=function(e){let t=useBVault(e),a=(0,c.useMemo)(()=>a=>{if(t.epochCount<=0n)return[];let n=u().range(1,parseInt((t.epochCount+1n).toString())).reverse(),o=a.sliceBVaultsStore.epoches,s=a.sliceBVaultsStore.epochesRedeemPool;return n.map(t=>{let a=o["".concat(e,"_").concat(t)],n=s["".concat(e,"_").concat(t)];return a&&n?(0,r.Yb)({...a,...n},0n):null}).filter(e=>null!=e)},[t]);return(0,d.R)(a)}(e),a=(0,d.R)(t=>t.sliceUserBVaults.epoches[e]||[]);return(0,c.useMemo)(()=>{let e=a.reduce((e,t)=>({...e,[t.epochId.toString()]:t}),{});return t.map(t=>(0,r.Yb)({...t,...e[t.epochId.toString()]||{bribes:[]}},0n))},[t,a])}function useCalcClaimable(e){let t=useEpochesData(e);return(0,c.useMemo)(()=>{let e=t.filter(e=>e.claimableAssetBalance&&e.settled);return{ids:e.map(e=>e.epochId),claimable:e.reduce((e,t)=>e+t.claimableAssetBalance,0n)}},[t])}function useBVaultBoost(e){let t=(0,d.R)(t=>t.sliceBVaultsStore.bvaults[e]),a=(0,d.R)(t=>t.sliceBVaultsStore.bvaultsCurrentEpoch[e]),n=t&&a&&a.assetAmountForSwapYT>0n?100n*t.lockedAssetTotal/a.assetAmountForSwapYT:100000n;return[(0,s.d)(n,0,2),n]}function useBVaultApy(e){let t=(0,d.R)(t=>t.sliceBVaultsStore.bvaultsCurrentEpoch[e]),a=t&&t.yTokenTotalSupplySynthetic>0n?t.assetAmountForSwapYT*n.SH*BigInt(1e10)/t.yTokenTotalSupplySynthetic:0n;return[(0,r.Jh)(a,10),a]}function useUpBVaultForUserAction(e){let{address:t}=(0,i.m)();return()=>{(0,r.XD)(async()=>{if(!t)return;await Promise.all([d.w.getState().sliceTokenStore.updateTokensBalance([e.asset,e.pToken],t),d.w.getState().sliceTokenStore.updateTokenTotalSupply([e.asset,e.pToken]),d.w.getState().sliceBVaultsStore.updateBvaults([e])]);let a=d.w.getState().sliceBVaultsStore.bvaults[e.vault];await Promise.all([await d.w.getState().sliceBVaultsStore.updateBvaultsCurrentEpoch({[e.vault]:a}),await d.w.getState().sliceBVaultsStore.updateEpoches(e,a.epochCount>1n?[a.epochCount,a.epochCount-1n]:[a.epochCount])]),await d.w.getState().sliceBVaultsStore.updateEpochesRedeemPool(e);let n=[];for(let t=parseInt(a.epochCount.toString());t>0;t--){let a=d.w.getState().sliceBVaultsStore.epoches["".concat(e.vault,"_").concat(t)],o=d.w.getState().sliceBVaultsStore.epochesRedeemPool["".concat(e.vault,"_").concat(t)].settled;n.push({epochId:BigInt(t),redeemPool:a.redeemPool,settled:o})}console.info("onUserAction:epoches",n),await d.w.getState().sliceUserBVaults.updateEpoches(e,t,n)},3,1e3)}}d.w.subscribe(e=>e.sliceBVaultsStore.bvaults)},3106:function(e,t,a){a.d(t,{w:function(){return g},R:function(){return useStoreShallow}});var n=a(83978),o=a.n(n),r=a(64103),s=a(93108),l=a(43794),u=a(73417),c=a(58714),i=a(62531),d=a(78403),p=a(26361),m=a(22139),h=a(19757);let f=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(a,n)=>o().mapValues(e,(e,o)=>e(e=>a({[o]:{...n()[o],...e}}),()=>n()[o],t[o]))}({sliceBVaultsStore:function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},updateBvaults=async a=>{let n=(0,d.B)(),o=await Promise.all(a.map(e=>Promise.all([n.readContract({abi:u.j5,address:e.vault,functionName:"epochIdCount"}),n.readContract({abi:c.Wo,address:e.pToken,functionName:"totalSupply"}),n.readContract({abi:u.j5,address:e.vault,functionName:"assetBalance"}),n.readContract({abi:u.j5,address:e.vault,functionName:"paramValue",args:[(0,i.$G)("f2",{size:32})]})]).then(e=>{let[t,a,n,o]=e;return{epochCount:t,pTokenTotal:a,lockedAssetTotal:n,f2:o}}))),r=o.reduce((e,t,n)=>({...e,[a[n].vault]:t}),{});return console.info("set:",r),e({bvaults:{...t().bvaults,...r}}),r},updateBvaultsCurrentEpoch=async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t().bvaults,n=(0,d.B)(),r=o().keys(a).map(e=>e);if(0==r.length)return{};let s=await Promise.all(r.map(e=>Promise.all([a[e].epochCount&&"0xF778D2B9E0238D385008e916D7245F51959Ba279"!==e?n.readContract({abi:u.j5,address:e,functionName:"Y"}):Promise.resolve(0n),a[e].epochCount?n.readContract({abi:u.j5,address:e,functionName:"yTokenTotalSupply",args:[a[e].epochCount]}):0n,a[e].epochCount?n.readContract({abi:u.j5,address:e,functionName:"yTokenTotalSupplySynthetic",args:[a[e].epochCount]}):0n,a[e].epochCount?n.readContract({abi:u.j5,address:e,functionName:"yTokenUserBalance",args:[a[e].epochCount,e]}):0n]).then(t=>{let[n,o,r,s]=t;return{Y:n,yTokenTotalSupply:o,yTokenTotalSupplySynthetic:r,assetAmountForSwapYT:(0,p.aE)(a[e].pTokenTotal-o,a[e].f2),yTokenAmountForSwapYT:o-s}}))),l=s.reduce((e,t,a)=>({...e,[r[a]]:t}),{});return e({bvaultsCurrentEpoch:{...t().bvaultsCurrentEpoch,...l}}),l},updateEpoches=async(a,n)=>{var r;let s=n||o().range(1,parseInt((((null===(r=t().bvaults[a.vault])||void 0===r?void 0:r.epochCount)||0n)+1n).toString())).map(e=>BigInt(e));if(0==s.length)return{};let l=(0,d.B)(),c=await Promise.all(s.map(e=>Promise.all([l.readContract({abi:u.j5,address:a.vault,functionName:"epochInfoById",args:[e]}),l.readContract({abi:u.j5,address:a.vault,functionName:"yTokenTotalSupply",args:[e]}),l.readContract({abi:u.j5,address:a.vault,functionName:"yTokenTotalSupplySynthetic",args:[e]}),l.readContract({abi:u.j5,address:a.vault,functionName:"yTokenUserBalance",args:[e,a.vault]})]).then(e=>{let[t,a,n,o]=e;return{...t,yTokenTotal:a,yTokenTotalSupplySynthetic:n,vaultYTokenBalance:o}}))),i=c.reduce((e,t)=>({...e,["".concat(a.vault,"_").concat(t.epochId.toString())]:t}),{});return e({epoches:{...t().epoches,...i}}),i},updateEpochesRedeemPool=async function(a){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t().epoches,r=o().keys(n).map(e=>({vault:e.split("_")[0],epochId:BigInt(e.split("_")[1]),epoch:n[e]}));if(0==r.length)return{};let s=(0,d.B)(),l=await Promise.all(r.map(e=>s.readContract({abi:u.gg,address:e.epoch.redeemPool,functionName:"settled"}).then(e=>({settled:e})))),c=l.reduce((e,t,n)=>({...e,["".concat(a.vault,"_").concat(r[n].epochId.toString())]:t}),{});return e({epochesRedeemPool:{...t().epochesRedeemPool,...c}}),c};return{bvaults:{},bvaultsCurrentEpoch:{},epoches:{},epochesRedeemPool:{},...a,updateBvaults,updateBvaultsCurrentEpoch,updateEpoches,updateEpochesRedeemPool}},sliceLVaultsStore:function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},updateLVaults=async a=>{let n=(0,d.B)();if(0==a.length)return{};let o=await Promise.all(a.map(e=>Promise.all([n.readContract({abi:u.Wn,address:e.vaultQuery,functionName:e.isStable?"getStableVaultState":"getVaultState",args:[e.vault]}),n.readContract({abi:u.WW,address:e.vault,functionName:"assetBalance"}),n.readContract({abi:u.WW,address:e.vault,functionName:"usdTotalSupply"}),n.readContract({abi:u.WW,address:e.vault,functionName:"vaultMode"}),n.readContract({abi:u.WW,address:e.vault,functionName:"paramValue",args:[(0,i.$G)("Y",{size:32})]}),e.ptyPoolBelowAddress?n.readContract({abi:u.aT,address:e.ptyPoolBelowAddress,functionName:"totalStakingBalance"}):Promise.resolve(0n),e.ptyPoolAboveAddress?n.readContract({abi:u.aT,address:e.ptyPoolAboveAddress,functionName:"totalStakingBalance"}):Promise.resolve(0n),e.ptyPoolBelowAddress?n.getBalance({address:e.ptyPoolBelowAddress}):Promise.resolve(0n),n.readContract({abi:u.nq,address:e.assetTokenFeed,functionName:"latestPrice"}),n.readContract({abi:u.WW,address:e.vault,functionName:"paramValue",args:[(0,i.$G)("CircuitBreakPeriod",{size:32})]})]).then(t=>{let[a,n,o,r,s,l,u,c,i,d]=t,p=BigInt(Math.floor(new Date().getTime()/1e3)),h=e.isStable?a.M_USDCx>0n&&a.aar<a.AARS:2==r&&(a.aar>=a.AARC||p-a.AARBelowCircuitBreakerLineTime>d);return{...{...a,isStable:!!e.isStable},assetBalance:n,usbTotalSupply:o,vaultMode:e.isStable?a.aar<a.AARS&&a.M_USDC>0n?2:1:r,Y:s,buyPoolTotalStaking:l,sellPoolTotalStaking:u,buyPoolBalance:c,latestPrice:i*m.Pq/m.pn,CircuitBreakPeriod:d,discountEnable:h}}))),r=o.reduce((e,t,n)=>({...e,[a[n].vault]:t}),{});return e({lvaults:{...t().lvaults,...r}}),r},updateUserLVault=async(a,n)=>{let o=(0,d.B)();if(a.isStable)return;let[r,s,l,c,i,p,m]=await Promise.all([o.readContract({abi:u.aT,address:a.ptyPoolBelowAddress,functionName:"userStakingBalance",args:[n]}),o.readContract({abi:u.aT,address:a.ptyPoolBelowAddress,functionName:"earnedMatchedToken",args:[n]}),o.readContract({abi:u.aT,address:a.ptyPoolBelowAddress,functionName:"earnedStakingYields",args:[n]}).catch(()=>0n),o.readContract({abi:u.aT,address:a.ptyPoolBelowAddress,functionName:"earnedMatchingYields",args:[n]}),o.readContract({abi:u.aT,address:a.ptyPoolAboveAddress,functionName:"userStakingBalance",args:[n]}),o.readContract({abi:u.aT,address:a.ptyPoolAboveAddress,functionName:"earnedMatchedToken",args:[n]}),o.readContract({abi:u.aT,address:a.ptyPoolAboveAddress,functionName:"earnedMatchingYields",args:[n]})]),h={buyPool_userStakingBalance:r,buyPool_earnedMatchedToken:s,buyPool_earnedStakingYields:l,buyPool_earnedMatchingYields:c,sellPool_userStakingBalance:i,sellPool_earnedMatchedToken:p,sellPool_earnedMatchingYields:m};return e({user:{...t().user,[a.vault]:h}}),h};return{lvaults:{},user:{},...a,updateLVaults,updateUserLVault}},sliceTokenStore:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let updateTokenTotalSupply=async a=>{if(0==a.length)return{};let n=(0,d.B)(),o=await Promise.all(a.map(e=>e==h.K8?Promise.resolve(0n):n.readContract({abi:c.Wo,address:e,functionName:"totalSupply"}))),r=o.reduce((e,t,n)=>({...e,[a[n]]:t}),{});return e({totalSupply:{...t().totalSupply,...r}}),r},updateTokensBalance=async(a,n)=>{if(0==a.length)return{};let o=(0,d.B)(),r=await Promise.all(a.map(e=>e==h.K8?o.getBalance({address:n}):o.readContract({abi:c.Wo,address:e,functionName:"balanceOf",args:[n]}))),s=r.reduce((e,t,n)=>({...e,[a[n]]:t}),{});return e({balances:{...t().balances,...s}}),s};return{totalSupply:{},updateTokenTotalSupply,balances:{},updateTokensBalance}},sliceUserBVaults:(e,t,a)=>{let updateEpoches=async(a,n,o)=>{let r=o.filter(e=>e.epochId>0n);if(0==r.length)return{};let s=(0,d.B)();console.info("updateEpoches:",r);let l=await Promise.all(r.map(e=>{let{epochId:t,redeemPool:o,settled:r}=e;return Promise.all([s.readContract({abi:u.j5,address:a.vault,functionName:"calcBribes",args:[t,n]}),r?Promise.resolve(0n):s.readContract({abi:u.gg,address:o,functionName:"userRedeemingBalance",args:[n]}).catch(()=>0n),s.readContract({abi:u.gg,address:o,functionName:"earnedAssetAmount",args:[n]}),s.readContract({abi:u.j5,address:a.vault,functionName:"yTokenUserBalance",args:[t,n]}),s.readContract({abi:u.j5,address:a.vault,functionName:"yTokenUserBalanceSynthetic",args:[t,n]})]).then(e=>{let[a,n,o,r,s]=e;return{epochId:t,bribes:a,redeemingBalance:n,claimableAssetBalance:o,userBalanceYToken:r,userBalanceYTokenSyntyetic:s}})})),i=await Promise.all(l.map(e=>{let{epochId:t,bribes:n}=e;return Promise.all(n.map(e=>Promise.all([s.readContract({abi:u.j5,address:a.vault,functionName:"bribeTotalAmount",args:[t,e.bribeToken]}),s.readContract({abi:c.Wo,address:e.bribeToken,functionName:"symbol"})]).then(t=>{let[a,n]=t;return{...e,totalRewards:a,bribeSymbol:n}})))})),p=l.map((e,t)=>({...e,bribes:i[t]})).sort((e,t)=>parseInt((t.epochId-e.epochId).toString()));return e({epoches:{...t().epoches,[a.vault]:p}}),p};return{epoches:{},...a,updateEpoches,reset:()=>e({epoches:{}})}}},{}),b=(0,l.mW)(f,{name:"BoundStore",store:"BoundStore",enabled:!0}),g=(0,s.Ue)(b);function useStoreShallow(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=g();return(0,r.useMemo)(()=>e(a),[a,...t])}},84944:function(e,t,a){a.d(t,{d:function(){return displayBalance}});var n=a(35057);let displayBalance=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:18;if(!e)return"0";let fmtNumber=e=>e.toLocaleString("en-US",{maximumFractionDigits:t}),o=Number((0,n.b)(e,a)),r=Number((.1**t).toFixed(t));return o>0&&o<r?o<.001?fmtNumber(1e6*o)+"μ":"<"+r:o<0&&o>-r?"≈0":fmtNumber(o)}}}]);