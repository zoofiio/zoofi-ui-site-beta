(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4763],{79391:function(){},88439:function(e,t,a){"use strict";a.d(t,{b:function(){return useMemoOfChainId}});var n=a(64103),s=a(59175);function useMemoOfChainId(e){let t=(0,s.p)(),a=(0,n.useRef)({});return(0,n.useMemo)(()=>(a.current[t]||(a.current[t]=e()),a.current[t]),[t])}},45438:function(e,t,a){"use strict";a.d(t,{i:function(){return u},p:function(){return useUpdatePtypoolApy}});var n=a(19757),s=a(22139),o=a(64103),l=a(33737),r=a(93108),d=a(59175);let u=(0,r.Ue)(e=>({update:e}));function useUpdatePtypoolApy(e,t,a){let r=(0,d.p)(),i=n.iK[r],c=Object.values(e).reduce((e,t)=>t.totalStake+e,0n),{update:b}=u();(0,o.useEffect)(()=>{i.forEach(o=>{let d=a[o.vault];if(o.ptyPoolAboveAddress&&e[o.ptyPoolAboveAddress]&&b({[o.ptyPoolAboveAddress]:{staking:(0,l.v)("0.025",10),matching:0n}}),o.ptyPoolBelowAddress&&e[o.ptyPoolBelowAddress]){let a=e[o.ptyPoolBelowAddress].totalStake*t[n.O1[r]];console.info("hhh:",a);let l=a>0n&&d.settingsDecimals>0n?d.M_ETHx*d.Y*t[o.xTokenAddress]*s.Pq/2n/a/d.settingsDecimals**10n:0n;b({[o.ptyPoolBelowAddress]:{staking:l*10n**10n/s.Pq,matching:0n}})}})},[i,c,e,t,a])}},49340:function(e,t,a){"use strict";let n;a.d(t,{g:function(){return E},A:function(){return FetcherProvider}});var s=a(31113),o=a(73417),l=a(44769),r=a(83606);let instance=()=>(n&&n.defaults.baseURL==="https://earlyaccess-beta.".concat(l.Kh.value,"/api")||(n=r.Z.create({baseURL:"https://earlyaccess-beta.".concat(l.Kh.value,"/api"),timeout:1e4,headers:{"Content-Type":"application/json"}})),n);var d={get:async function(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.startsWith("/auth")){let e=localStorage.getItem("earlyaccess-token");if(!e)throw"Need token";n.headers={...n.headers||{},Authorization:e}}let s=await instance().get(e,{...n,params:a});if(console.info("res:",null==s?void 0:s.data),(null==s?void 0:null===(t=s.data)||void 0===t?void 0:t.code)!==200)throw s.data;return s.data.data},post:async function(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.startsWith("/auth")){let e=localStorage.getItem("earlyaccess-token");if(!e)throw"Need token";n.headers={...n.headers||{},Authorization:e}}let s=await instance().post(e,a,n);if((null==s?void 0:null===(t=s.data)||void 0===t?void 0:t.code)!==200)throw s.data;return s.data.data}};let getPtypoolYields=async()=>{let e=await d.get("/common/ptypool/yields");return e};var u=a(19757);let getTokens=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return u.iK[e].map(e=>({symbol:e.assetTokenSymbol,address:e.assetTokenAddress})).concat(u.iK[e].map(e=>({symbol:e.xTokenSymbol,address:e.xTokenAddress}))).concat([{symbol:u.TW,address:u.O1[e]}]).concat((u.VQ[e]||[]).map(e=>({symbol:e.assetTokenSymbol,address:e.assetToken}))).filter(e=>!t||e.symbol!==u.Ku)};var i=a(22139),c=a(59175),b=a(64103),m=a(25233),p=a(87958),v=a(41340),f=a(73216),k=a(88439),h=a(26361),y=a(96670),S=a(15506),g=a(45438),A=a(23647),T=a(64370),Y=a(83978),P=a.n(Y),N=a(68940),w=a(62531),B=a(58714),D=a(35057),M=a(47972),W=a(18358);let E=(0,b.createContext)({balances:(0,h.Yb)({},0n),totalSupplies:(0,h.Yb)({},0n),prices:(0,h.Yb)({},0n),assetLocked:(0,h.Yb)({},0n),aar:(0,h.Yb)({},0),vaultUSBTotal:(0,h.Yb)({},0n),vaultsMode:(0,h.Yb)({},0),vaultsDiscount:(0,h.Yb)({},!1),vaultsState:(0,h.Yb)({},(0,h.Yb)({},0n)),stableVaultsState:(0,h.Yb)({},(0,h.Yb)({},0n)),earns:(0,h.Yb)({},(0,h.Yb)({},0n)),usbApr:{apr:0n,aprDecimals:10},plainVaultsStat:(0,h.Yb)({},(0,h.Yb)({},0n))}),FetcherProvider=e=>{let{children:t}=e;(0,W.d6)(),(0,A.rs)();let a=(0,S.hp)(),n=(0,c.p)();!function(){let{chainId:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,m.m)({chainId:e});b.useMemo(()=>(t&&(f.ON.provider=function(e){var t,a;let{chain:n,transport:s}=e,o={chainId:n.id,name:n.name,ensAddress:null===(a=n.contracts)||void 0===a?void 0:null===(t=a.ensRegistry)||void 0===t?void 0:t.address};return"fallback"===s.type?new p.H(s.transports.map(e=>{let{value:t}=e;return new v.r(null==t?void 0:t.url,o)})):new v.r(s.url,o)}(t)),f.ON.provider),[t])}();let{address:l}=(0,y.m)(),{data:r}=(0,M.K)({address:l,chainId:n,query:{enabled:!!l,refetchOnMount:!1,refetchOnWindowFocus:!1},wandtime:a.time}),d=(0,b.useMemo)(()=>getTokens(n),[n]),{data:Y}=(0,S.uX)({contracts:[...d.map(e=>({address:e.address,abi:B.Wo,functionName:"balanceOf",args:[l],chainId:n}))],query:{enabled:!!l}}),{data:_}=(0,S.uX)({contracts:[...d.map(e=>({address:e.address,abi:B.Wo,functionName:"totalSupply",chainId:n}))]}),U=(0,k.b)(()=>(0,h.Yb)({},0n));U[u.K8]=(0,h.ok)(r,"value"),d.forEach((e,t)=>{U[e.address]=(0,h.ok)(Y,[t,"result"])});let q=(0,k.b)(()=>(0,h.Yb)({},0n));d.forEach((e,t)=>{q[e.address]=(0,h.ok)(_,[t,"result"])});let X=u.iK[n],K=function(){let e=(0,c.p)(),t=u.iK[e],{data:a}=(0,S.uX)({contracts:[...t.map(e=>({vc:e,abi:o.nq,address:e.assetTokenFeed,functionName:"latestPrice"}))]}),{data:n}=(0,S.uX)({query:{gcTime:i.pn},contracts:[...t.map(e=>({abi:o.nq,address:e.assetTokenFeed,functionName:"decimals"}))]});return(0,b.useMemo)(()=>{let e={};return t.forEach((t,s)=>{let o=(0,h.ok)(a,[s,"result"]),l=(0,h.ok)(n,[s,"result"]);e[t.assetTokenAddress]=[o,l]}),e},[a,n,t])}(),{data:O}=(0,S.uX)({contracts:[...X.map(e=>({vc:e,abi:o.WW,address:e.vault,functionName:"assetBalance"}))]}),{data:C}=(0,S.uX)({contracts:[...X.map(e=>({abi:o.WW,address:e.vault,functionName:"usdTotalSupply"}))]}),{data:x}=(0,S.uX)({contracts:[...X.map(e=>({vc:e,abi:o.Wn,address:u.O6[n],functionName:"AAR",args:[e.vault]}))]}),{data:R}=(0,S.uX)({query:{gcTime:i.pn},contracts:[...X.map(e=>({abi:o.WW,address:e.vault,functionName:"AARDecimals"}))]}),{data:I}=(0,S.uX)({contracts:[...X.map(e=>({abi:o.WW,address:e.vault,functionName:"vaultMode"}))]}),{data:F}=(0,S.uX)({contracts:[...X.map(e=>({vc:e,abi:o.Wn,address:u.O6[n],functionName:e.isStable?"getStableVaultState":"getVaultState",args:[e.vault]}))]}),{data:V}=(0,S.uX)({query:{gcTime:i.pn},contracts:[...X.map(e=>({vc:e,abi:o.WW,address:e.vault,functionName:"paramValue",args:[(0,w.$G)("Y",{size:32})]}))]}),H=(0,k.b)(()=>(0,h.Yb)({[u.O1[n]]:i.Pq},0n)),z=(0,k.b)(()=>(0,h.Yb)({},0n)),L=(0,k.b)(()=>(0,h.Yb)({},0n)),j=(0,k.b)(()=>(0,h.Yb)({},0n)),G=(0,k.b)(()=>(0,h.Yb)({},0)),Q=(0,k.b)(()=>(0,h.Yb)({},(0,h.Yb)({},0n))),Z=(0,k.b)(()=>(0,h.Yb)({},(0,h.Yb)({},0n))),$=function(e,t,a){let n=(0,k.b)(()=>(0,h.Yb)({},!1)),s=(0,c.p)(),l=u.iK[s],{data:r}=(0,S.uX)({contracts:l.map(e=>({vc:e,abi:o.WW,address:e.vault,functionName:"paramValue",args:[(0,w.$G)("CircuitBreakPeriod",{size:32})]}))});return l.forEach((s,o)=>{if(s.isStable){let e=t[(null==s?void 0:s.vault)||"null"];n[s.vault]=e&&e.M_USDCx>0n&&e.aar<e.AARS}else{let t=(0,h.ok)(r,[o,"result"]),l=e[(null==s?void 0:s.vault)||"null"],d=a[(null==s?void 0:s.vault)||"null"],u=(0,h.ok)(l,"AARBelowCircuitBreakerLineTime"),i=2==d&&l&&((0,h.ok)(l,"aar")>=(0,h.ok)(l,"AARC")||BigInt(Math.floor(new Date().getTime()/1e3))-u>=t);n[s.vault]=i}}),n}(Q,Z,G);X.forEach((e,t)=>{var a,s,o;let l=(0,h.ok)(O,[t,"result"]),r=(0,h.ok)(C,[t,"result"]),d=(0,h.ok)(K[e.assetTokenAddress],[0]),c=(0,h.ok)(K[e.assetTokenAddress],[1]);j[e.vault]=r;let b=c>0n?d*i.Pq/10n**c:0n;H[e.assetTokenAddress]=b;let m=q[e.xTokenAddress],p=m>0n&&l>0n&&b>0n&&r>0n&&l*b>r*i.Pq?(l*b-r*i.Pq)/m:0n;m>0n&&l>0n&&b>0n&&r>0n&&l*b<r*i.Pq&&(H[u.O1[n]]=l*b/r),H[e.xTokenAddress]=p,z[e.assetTokenAddress]=l;let v=(0,D.b)((0,h.ok)(x,[t,"result"]),parseInt((0,h.ok)(R,[t,"result"]).toString()));L[e.vault]=parseFloat(v),e.isStable?Z[e.vault]=(0,h.Yb)({ettingsDecimals:10n,...null==F?void 0:null===(s=F[t])||void 0===s?void 0:s.result,Y:(0,h.ok)(V,[t,"result"])},0n):Q[e.vault]=(0,h.Yb)({settingsDecimals:10n,...null==F?void 0:null===(o=F[t])||void 0===o?void 0:o.result,Y:(0,h.ok)(V,[t,"result"])},0n);let f=Z[e.vault];G[e.vault]=e.isStable?f.aar<f.AARS&&f.M_USDC>0n?2:1:(null==I?void 0:null===(a=I[t])||void 0===a?void 0:a.result)||0});let J=function(){let{address:e}=(0,y.m)(),t=(0,c.p)(),a=(0,b.useMemo)(()=>u.iK[t].filter(e=>!e.isStable&&e.ptyPoolAboveAddress&&e.ptyPoolBelowAddress).map(e=>[{poolAddress:e.ptyPoolBelowAddress,stakeSymbol:u.TW,matchSymbol:e.assetTokenSymbol,earnSymbol:e.xTokenSymbol,earnForMatchSymbol:e.assetTokenSymbol},{poolAddress:e.ptyPoolAboveAddress,stakeSymbol:e.assetTokenSymbol,matchSymbol:u.TW,earnSymbol:e.assetTokenSymbol,earnForMatchSymbol:e.xTokenSymbol}]).flat(),[t]),{data:n}=(0,S.uX)({query:{enabled:!!e},contracts:[...a.map(t=>{let{poolAddress:a}=t;return{abi:o.aT,address:a,functionName:"userStakingBalance",args:[e]}}),...a.map(t=>{let{poolAddress:a}=t;return{abi:o.aT,address:a,functionName:"earnedMatchedToken",args:[e]}}),...a.map(t=>{let{poolAddress:a}=t;return{abi:o.aT,address:a,functionName:"earnedStakingYields",args:[e]}}),...a.map(t=>{let{poolAddress:a}=t;return{abi:o.aT,address:a,functionName:"earnedMatchingYields",args:[e]}})]}),{data:s}=(0,S.uX)({contracts:[...a.map(e=>{let{poolAddress:t}=e;return{abi:o.aT,address:t,functionName:"totalStakingBalance"}})]}),l=(0,A.Ul)(),{data:r}=(0,T.a)({queryKey:[a,l],initialData:(0,h.Yb)({},0n),queryFn:async()=>{let e=(0,h.Yb)({},0n);if(!l)return e;let t=a.filter(e=>e.matchSymbol==u.Ku),n=await Promise.all(t.map(e=>l.getBalance({address:e.poolAddress})));return t.forEach((t,a)=>{e[t.poolAddress]=n[a]}),e}}),d=(0,k.b)(()=>(0,h.Yb)({},(0,h.Yb)({},0n)));return a.forEach((e,t)=>{let{poolAddress:o,stakeSymbol:l,matchSymbol:u,earnSymbol:i}=e,c=(0,h.ok)(n,[t,"result"]),b=(0,h.ok)(n,[t+a.length,"result"]),m=(0,h.ok)(n,[t+2*a.length,"result"]),p=(0,h.ok)(n,[t+3*a.length,"result"]),v=(0,h.ok)(s,[t,"result"]),f=(0,h.ok)(r,o);d[o]={stakeSymbol:l,matchSymbol:u,earnSymbol:i,stake:c,match:b,earn:m,earnForMatch:p,totalStake:v,balance:f}}),d}(),ee=function(e,t){let a=(0,c.p)(),n=0,s=0n,o=0n;return u.iK[a].forEach(a=>{if(a.isStable){let e=t[a.vault];s+=e.M_USB_USDC*e.Y*e.aar/10n**e.AARDecimals,o+=e.M_USB_USDC,e.M_USB_USDC>0n&&e.Y>0n&&n++}else{let t=e[a.vault];s+=t.M_USB_ETH*t.Y,o+=t.M_USB_ETH,t.M_USB_ETH>0n&&t.Y>0n&&n++}}),{apr:o>0n?s/o:0n,aprDecimals:10}}(Q,Z);(0,b.useEffect)(()=>{setInterval(()=>{let e=S.hp.getState();P().now()-e.time>=36e5&&e.update()},36e5)},[]);let{value:et={}}=(0,N.Z)(getPtypoolYields,[a.time]);(0,g.p)(J,H,Q);let ea=function(e){let t=(0,c.p)(),{address:a}=(0,y.m)(),n=u.VQ[t]||[],{data:s}=(0,S.uX)({contracts:[...n.map(e=>({abi:o.a4,address:e.vault,functionName:"totalSupply"})),...n.map(e=>({abi:o.a4,address:e.vault,functionName:"balanceOf",args:[a]}))]}),{data:l}=(0,S.uX)({contracts:[{abi:o.pE,address:"0xcD96262Df56127f298b452FA40759632868A472a",functionName:"latestRoundData"},{abi:o.pE,address:"0x0af23B08bcd8AD35D1e8e8f2D2B779024Bd8D24A",functionName:"latestRoundData"}]}),r=(0,h.ok)(l,[0,"result",1]),d=(0,h.ok)(l,[1,"result",1]),i=r*d*10n**2n,b=(0,k.b)(()=>(0,h.Yb)({},(0,h.Yb)({},0n)));return n.forEach((t,a)=>{"weETH"==t.assetTokenSymbol&&(e[t.assetToken]=i),b[t.vault]=b[t.vault],b[t.vault].totalSupply=(0,h.ok)(s,[a,"result"]),b[t.vault].userStaked=(0,h.ok)(s,[a+n.length,"result"])}),b}(H);return(0,s.jsx)(E.Provider,{value:{balances:U,totalSupplies:q,prices:H,assetLocked:z,aar:L,vaultUSBTotal:j,vaultsMode:G,vaultsDiscount:$,vaultsState:Q,stableVaultsState:Z,earns:J,usbApr:ee,ptypoolYields:et,plainVaultsStat:ea},children:t})}}}]);